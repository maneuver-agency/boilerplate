define(["modules/gmaps"],function(o){function n(n){var e,t,r,a;if(a=$.extend({id:"#gmaps",lat:51.166447,lng:4.155782,markers:[],addZoomControls:!0,scrollwheel:!1,zoom:11,markerIcon:"/assets/img/marker.png"},n),a.markers!==!1&&0===a.markers.length&&a.markers.push({lat:a.lat,lng:a.lng}),"undefined"!=typeof o&&$(a.id).length){for(l=new o({div:a.id,lat:a.lat,lng:a.lng,zoom:a.zoom,panControl:!1,scaleControl:!1,zoomControlOpt:{style:"SMALL"},zoomControl:!1,overviewMapControl:!1,streetViewControl:!1,mapTypeControl:!1,scrollwheel:a.scrollwheel,dragend:a.dragend||function(){},radius_changed:a.change||function(){},center_changed:a.change||function(){},zoom_changed:a.change||function(){},styles:[{stylers:[{gamma:1},{saturation:-50}]}]}),t=0,r=a.markers.length;r>t;t++)a.markers[t].icon||(a.markers[t].icon=a.markerIcon),"function"==typeof a.clickMarker&&(a.markers[t].click=a.clickMarker),s.push(l.addMarker(a.markers[t]));a.addZoomControls&&(e=$("<div />",{"class":"zoom-controls"}).appendTo("#gmaps"),$("<div />",{"class":"zoom-in"}).html('<i class="icon-plus"></i>').appendTo(e),$("<div />",{"class":"zoom-out"}).html('<i class="icon-minus"></i>').appendTo(e),$("#gmaps").on("click",".zoom-in",function(o){l.zoomIn()}).on("click",".zoom-out",function(o){l.zoomOut()}))}}function e(n){l&&o.geolocate({success:function(o){n?(l.drawRoute({origin:[o.coords.latitude,o.coords.longitude],destination:[marker.lat,marker.lng],travelMode:"driving",strokeColor:"#131540",strokeOpacity:.6,strokeWeight:6}),r()):(l.setCenter(o.coords.latitude,o.coords.longitude),l.setZoom(11))},error:function(o){},not_supported:function(){}})}function t(n){l&&n&&o.geocode({address:n,callback:function(o,n){if("OK"==n){var e=o[0].geometry.location;l.setCenter(e.lat(),e.lng()),l.setZoom(11)}}})}function r(){l&&l.fitZoom()}function a(){if(l&&s.length){var o=l.map.getBounds(),n=[];return[].map.call(s,function(e){o.contains(e.position)&&n.push(e)}),n}}function i(){return s}var l,s=[];return{getMap:function(){return l.map},create:n,locate:e,fit:r,goTo:t,getVisibleMarkers:a,getAllMarkers:i}});