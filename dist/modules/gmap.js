define(function(){function o(o){var n,e,t,r;if(r=$.extend({id:"#gmaps",lat:51.159444,lng:4.181447,markers:[],addZoomControls:!0,scrollwheel:!1,zoom:11},o),r.markers!==!1&&0===r.markers.length&&r.markers.push({lat:r.lat,lng:r.lng}),"undefined"!=typeof GMaps&&$(r.id).length){for(i=new GMaps({div:r.id,lat:r.lat,lng:r.lng,zoom:r.zoom,panControl:!1,scaleControl:!1,zoomControlOpt:{style:"SMALL"},zoomControl:!1,overviewMapControl:!1,streetViewControl:!1,mapTypeControl:!1,scrollwheel:r.scrollwheel,dragend:r.dragend||function(){},radius_changed:r.change||function(){},center_changed:r.change||function(){},zoom_changed:r.change||function(){},styles:[{stylers:[{gamma:1},{saturation:-50}]}]}),e=0,t=r.markers.length;t>e;e++)r.markers[e].icon="/theme/bertoy14/assets/img/marker.png","function"==typeof r.clickMarker&&(r.markers[e].click=r.clickMarker),s.push(i.addMarker(r.markers[e]));r.addZoomControls&&(n=$("<div />",{"class":"zoom-controls"}).appendTo("#gmaps"),$("<div />",{"class":"zoom-in"}).html('<i class="icon-plus"></i>').appendTo(n),$("<div />",{"class":"zoom-out"}).html('<i class="icon-minus"></i>').appendTo(n),$("#gmaps").on("click",".zoom-in",function(){i.zoomIn()}).on("click",".zoom-out",function(){i.zoomOut()}))}}function n(o){i&&GMaps.geolocate({success:function(n){o?(i.drawRoute({origin:[n.coords.latitude,n.coords.longitude],destination:[marker.lat,marker.lng],travelMode:"driving",strokeColor:"#131540",strokeOpacity:.6,strokeWeight:6}),t()):(i.setCenter(n.coords.latitude,n.coords.longitude),i.setZoom(11))},error:function(){},not_supported:function(){}})}function e(o){i&&o&&GMaps.geocode({address:o,callback:function(o,n){if("OK"==n){var e=o[0].geometry.location;i.setCenter(e.lat(),e.lng()),i.setZoom(11)}}})}function t(){i&&i.fitZoom()}function r(){if(i&&s.length){var o=i.map.getBounds(),n=[];return[].map.call(s,function(e){o.contains(e.position)&&n.push(e)}),n}}function a(){return s}var i,s=[];return{getMap:function(){return i.map},create:o,locate:n,fit:t,goTo:e,getVisibleMarkers:r,getAllMarkers:a}});